---
import FTCDisclosure from './FTCDisclosure.astro';

interface Pick {
  name: string;
  type: 'hotel' | 'restaurant' | 'tour' | 'activity' | 'transport';
  price: string;
  priceNote?: string;
  personalNote: string;
  affiliateUrl?: string;
  badge?: string;
}

interface Props {
  destination: string;
  picks: Pick[];
}

const { destination, picks } = Astro.props;

const hotels = picks.filter(p => p.type === 'hotel');
const restaurants = picks.filter(p => p.type === 'restaurant');
const experiences = picks.filter(p => p.type === 'tour' || p.type === 'activity');
const transport = picks.filter(p => p.type === 'transport');

const columns = [
  { title: 'Stay', icon: 'ðŸ¨', items: hotels },
  { title: 'Eat', icon: 'ðŸ´', items: restaurants },
  { title: 'Experience', icon: 'ðŸŽ¯', items: experiences },
  { title: 'Transport', icon: 'ðŸš', items: transport },
].filter(col => col.items.length > 0);
---

{picks.length > 0 && (
  <section class="trip-footer">
    <div class="trip-footer-inner">
      <h2 class="trip-footer-heading">Book Your {destination} Trip</h2>
      <p class="trip-footer-sub">Places we've stayed, eaten, and experienced â€” with real prices.</p>

      <div class="trip-footer-grid" style={`--col-count: ${columns.length}`}>
        {columns.map((col) => (
          <div class="trip-footer-col">
            <div class="trip-footer-col-header">
              <span class="trip-footer-col-icon">{col.icon}</span>
              <h3 class="trip-footer-col-title">{col.title}</h3>
            </div>
            <div class="trip-footer-items">
              {col.items.map((item) => (
                <a
                  href={item.affiliateUrl || '#'}
                  class="trip-footer-item"
                  target={item.affiliateUrl && item.affiliateUrl !== '#' ? '_blank' : undefined}
                  rel={item.affiliateUrl && item.affiliateUrl !== '#' ? 'noopener sponsored' : undefined}
                >
                  <div class="trip-footer-item-top">
                    <span class="trip-footer-item-name">{item.name}</span>
                    {item.badge && <span class="trip-footer-item-badge">{item.badge}</span>}
                  </div>
                  <div class="trip-footer-item-price">
                    {item.price}
                    {item.priceNote && <span class="trip-footer-item-pricenote">{item.priceNote}</span>}
                  </div>
                  <p class="trip-footer-item-note">{item.personalNote}</p>
                  <span class="trip-footer-item-cta">{item.type === 'transport' ? 'Book Transport' : 'Check Availability'} &rarr;</span>
                </a>
              ))}
            </div>
          </div>
        ))}
      </div>

      <div class="trip-footer-disclosure">
        <FTCDisclosure placement="inline" />
      </div>
    </div>
  </section>
)}

<style>
  .trip-footer {
    background: var(--color-deep-night);
    padding: var(--space-16) var(--space-6);
  }

  .trip-footer-inner {
    max-width: var(--content-lg);
    margin: 0 auto;
  }

  .trip-footer-heading {
    color: white;
    text-align: center;
    margin-bottom: var(--space-2);
    font-size: var(--text-h2);
  }

  .trip-footer-sub {
    text-align: center;
    color: rgba(255, 255, 255, 0.5);
    font-size: 0.9rem;
    margin-bottom: var(--space-10);
  }

  .trip-footer-grid {
    display: grid;
    grid-template-columns: repeat(var(--col-count, 3), 1fr);
    gap: var(--space-6);
  }

  @media (max-width: 768px) {
    .trip-footer-grid {
      grid-template-columns: 1fr;
    }
  }

  .trip-footer-col-header {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    margin-bottom: var(--space-4);
    padding-bottom: var(--space-3);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  .trip-footer-col-icon {
    font-size: 1.2rem;
  }

  .trip-footer-col-title {
    font-size: 0.85rem;
    font-weight: var(--weight-bold);
    color: rgba(255, 255, 255, 0.7);
    text-transform: uppercase;
    letter-spacing: 0.1em;
  }

  .trip-footer-items {
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
  }

  .trip-footer-item {
    display: block;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 12px;
    padding: var(--space-4);
    text-decoration: none;
    color: inherit;
    transition: background-color 0.3s ease, border-color 0.3s ease;
  }

  .trip-footer-item:hover {
    background: rgba(255, 255, 255, 0.09);
    border-color: rgba(255, 255, 255, 0.15);
  }

  .trip-footer-item-top {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-2);
    margin-bottom: var(--space-1);
  }

  .trip-footer-item-name {
    font-size: 0.92rem;
    font-weight: var(--weight-semibold);
    color: white;
  }

  .trip-footer-item-badge {
    font-size: 0.6rem;
    font-weight: var(--weight-bold);
    color: white;
    background: var(--color-warm-coral);
    padding: 2px 8px;
    border-radius: 4px;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    white-space: nowrap;
  }

  .trip-footer-item-price {
    font-size: 0.85rem;
    font-weight: var(--weight-bold);
    color: var(--color-ocean-teal-light, #14B8A6);
    margin-bottom: var(--space-2);
  }

  .trip-footer-item-pricenote {
    font-size: 0.72rem;
    font-weight: var(--weight-regular);
    color: rgba(255, 255, 255, 0.4);
    margin-left: 4px;
  }

  .trip-footer-item-note {
    font-size: 0.78rem;
    font-style: italic;
    color: rgba(255, 255, 255, 0.5);
    line-height: 1.45;
    margin-bottom: var(--space-3);
  }

  .trip-footer-item-cta {
    font-size: 0.75rem;
    font-weight: var(--weight-semibold);
    color: var(--color-ocean-teal-light, #14B8A6);
    transition: color 0.2s ease;
  }

  .trip-footer-item:hover .trip-footer-item-cta {
    color: white;
  }

  .trip-footer-disclosure {
    margin-top: var(--space-8);
  }

  .trip-footer-disclosure :global(.ftc-disclosure--inline) {
    background: rgba(255, 255, 255, 0.05);
    color: rgba(255, 255, 255, 0.5);
  }

  .trip-footer-disclosure :global(.ftc-disclosure strong) {
    color: rgba(255, 255, 255, 0.7);
  }

  .trip-footer-disclosure :global(.ftc-disclosure a) {
    color: var(--color-ocean-teal-light, #14B8A6);
  }
</style>
