---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Breadcrumb from '../../components/Breadcrumb.astro';
import EmailCapture from '../../components/EmailCapture.astro';
import FAQ from '../../components/FAQ.astro';

const breadcrumbs = [
  { name: 'Home', url: '/' },
  { name: 'Festival Calendar', url: '/festivals/' },
];

const pageTitle = 'Vietnamese Festival Calendar 2026';
const pageDescription = 'From Tet\'s fireworks and family feasts to Hoi An\'s magical lantern nights — time your trip to the celebrations that define each destination.';

const festivals = [
  {
    month: 'Jan',
    monthIndex: 0,
    name: 'Tet Nguyen Dan (Lunar New Year)',
    destination: 'Nationwide',
    slug: 'hanoi',
    description: 'Vietnam\'s biggest and most important celebration — a week-long holiday marking the Lunar New Year. Families reunite, streets fill with flower markets, and midnight fireworks light up every city. Hanoi\'s Hoan Kiem Lake and HCMC\'s Nguyen Hue Walking Street are the best places to ring in the new year.',
  },
  {
    month: 'Jan',
    monthIndex: 0,
    name: 'Flower Festival',
    destination: 'Da Lat',
    slug: 'dalat',
    description: 'Da Lat\'s biennial flower festival transforms the highland city into a garden wonderland. Elaborate floral displays, parades, and cultural performances celebrate the "City of Eternal Spring" and its famous flower-growing heritage.',
  },
  {
    month: 'Feb',
    monthIndex: 1,
    name: 'Perfume Pagoda Festival',
    destination: 'Hanoi',
    slug: 'hanoi',
    description: 'Pilgrims flock to the Huong Son complex southwest of Hanoi for this Buddhist festival. Boat rides along the Yen Stream lead to a dramatic cave pagoda in the limestone mountains — one of Vietnam\'s most atmospheric religious celebrations.',
  },
  {
    month: 'Feb',
    monthIndex: 1,
    name: 'Lim Festival',
    destination: 'Bac Ninh (near Hanoi)',
    slug: 'hanoi',
    description: 'A celebration of Quan Ho folk singing — UNESCO-recognized duets between young men and women in traditional dress. The festival takes place on the 13th day of the first lunar month in Bac Ninh province, a short trip from Hanoi.',
  },
  {
    month: 'Mar',
    monthIndex: 2,
    name: 'Hue Festival',
    destination: 'Hue',
    slug: 'hue',
    description: 'Vietnam\'s premier cultural festival held biennially in the Imperial City. Two weeks of traditional music, court dances, ao dai fashion shows, art installations, and culinary events set against the backdrop of the UNESCO-listed Citadel.',
  },
  {
    month: 'Apr',
    monthIndex: 3,
    name: 'Hung Kings Temple Festival',
    destination: 'Phu Tho (near Hanoi)',
    slug: 'hanoi',
    description: 'National holiday honoring the legendary founders of Vietnam at the Hung Kings Temple. Elaborate rituals, traditional games, and the iconic Banh Chung making contest draw pilgrims from across the country on the 10th day of the third lunar month.',
  },
  {
    month: 'Apr',
    monthIndex: 3,
    name: 'Thay Pagoda Festival',
    destination: 'Hanoi',
    slug: 'hanoi',
    description: 'One of the oldest festivals near Hanoi celebrating the monk Tu Dao Hanh. Water puppet performances on the pagoda\'s pond, boat races, and traditional ceremonies in a stunning mountain setting.',
  },
  {
    month: 'Apr',
    monthIndex: 3,
    name: 'Reunification Day',
    destination: 'Ho Chi Minh City',
    slug: 'ho-chi-minh-city',
    description: 'April 30 marks the reunification of Vietnam with citywide celebrations in HCMC. Parades along Le Duan Boulevard, fireworks over the Saigon River, and a festive atmosphere across the country. Combined with May Day on May 1 for a long holiday weekend.',
  },
  {
    month: 'May',
    monthIndex: 4,
    name: 'Buddha\'s Birthday (Vesak)',
    destination: 'Nationwide',
    slug: 'hue',
    description: 'Pagodas across Vietnam celebrate with lantern processions, flower offerings, and candlelit ceremonies. Hue is especially spectacular — thousands of lotus-shaped lanterns float down the Perfume River as monks chant in the ancient pagodas.',
  },
  {
    month: 'Jun',
    monthIndex: 5,
    name: 'Nha Trang Sea Festival',
    destination: 'Nha Trang',
    slug: 'nha-trang',
    description: 'A biennial celebration of Nha Trang\'s maritime culture with boat races, beach sports, seafood festivals, and cultural performances along the coastal city\'s famous beachfront. Music stages and art exhibitions bring the seaside promenade to life.',
  },
  {
    month: 'Jul',
    monthIndex: 6,
    name: 'Hoi An Lantern Festival',
    destination: 'Hoi An',
    slug: 'hoi-an',
    description: 'On the 14th day of each lunar month, Hoi An\'s Ancient Town turns off its electric lights and glows with hundreds of silk lanterns and candles. Paper lanterns float down the Thu Bon River while traditional music fills the streets. The most magical night in Vietnam.',
  },
  {
    month: 'Aug',
    monthIndex: 7,
    name: 'Vu Lan (Ghost Festival)',
    destination: 'Nationwide',
    slug: 'hue',
    description: 'The Buddhist "Wandering Souls Day" on the 15th of the seventh lunar month. Families visit pagodas, burn offerings for ancestors, and release paper lanterns. In Hue, the Perfume River fills with floating lights — hauntingly beautiful.',
  },
  {
    month: 'Sep',
    monthIndex: 8,
    name: 'Mid-Autumn Festival (Tet Trung Thu)',
    destination: 'Nationwide',
    slug: 'hanoi',
    description: 'Vietnam\'s enchanting children\'s festival — lion dances wind through neighborhoods, kids carry star-shaped lanterns, and mooncakes are shared with family. Hanoi\'s Old Quarter and Hoi An are the best places to experience the lantern-lit celebrations.',
  },
  {
    month: 'Sep',
    monthIndex: 8,
    name: 'National Day',
    destination: 'Hanoi',
    slug: 'hanoi',
    description: 'September 2 celebrates Vietnam\'s declaration of independence with military parades, cultural performances, and fireworks at Ba Dinh Square in Hanoi — where Ho Chi Minh read the proclamation in 1945.',
  },
  {
    month: 'Oct',
    monthIndex: 9,
    name: 'Kate Festival',
    destination: 'Ninh Thuan (near Nha Trang)',
    slug: 'nha-trang',
    description: 'The Cham people\'s most important celebration honoring their ancestors and deities at the Po Klong Garai temple towers. Traditional Cham music, dance, and ceremonies offer a rare window into this ancient culture.',
  },
  {
    month: 'Oct',
    monthIndex: 9,
    name: 'Da Nang International Fireworks Festival',
    destination: 'Da Nang',
    slug: 'da-nang',
    description: 'Teams from around the world compete in spectacular fireworks displays over the Han River. The festival runs over several weekends in spring/summer with live music, food stalls, and a carnival atmosphere along the riverfront.',
  },
  {
    month: 'Nov',
    monthIndex: 10,
    name: 'Dalat Flower Festival',
    destination: 'Da Lat',
    slug: 'dalat',
    description: 'Da Lat\'s famous flower festival (held in late autumn or early winter depending on the year) showcases the highland city\'s horticultural heritage with elaborate floral displays, garden exhibitions, and cultural performances.',
  },
  {
    month: 'Dec',
    monthIndex: 11,
    name: 'Christmas in Vietnam',
    destination: 'Ho Chi Minh City',
    slug: 'ho-chi-minh-city',
    description: 'Vietnam goes all-out for Christmas regardless of religion. HCMC\'s Notre-Dame Cathedral area and District 1 transform into a winter wonderland of lights. Hanoi\'s Hoan Kiem district fills with festive decorations. The energy and crowds rival any Western city.',
  },
];

const months = [
  'January', 'February', 'March', 'April', 'May', 'June',
  'July', 'August', 'September', 'October', 'November', 'December',
];

const monthGradients = [
  'linear-gradient(135deg, #E8654A 0%, #D4A853 100%)',
  'linear-gradient(135deg, #C05299 0%, #E8654A 100%)',
  'linear-gradient(135deg, #4CAF50 0%, #8BC34A 100%)',
  'linear-gradient(135deg, #FF9800 0%, #FFC107 100%)',
  'linear-gradient(135deg, #9E9E9E 0%, #BDBDBD 100%)',
  'linear-gradient(135deg, #0D7377 0%, #4DB6AC 100%)',
  'linear-gradient(135deg, #1565C0 0%, #42A5F5 100%)',
  'linear-gradient(135deg, #6A1B9A 0%, #AB47BC 100%)',
  'linear-gradient(135deg, #9E9E9E 0%, #BDBDBD 100%)',
  'linear-gradient(135deg, #E65100 0%, #FF9800 100%)',
  'linear-gradient(135deg, #BF360C 0%, #E8654A 100%)',
  'linear-gradient(135deg, #1A2332 0%, #C62828 0%, #FFD54F 100%)',
];

// Extract first color from each month gradient for map markers
const monthColors = [
  '#E8654A', '#C05299', '#4CAF50', '#FF9800', '#9E9E9E', '#0D7377',
  '#1565C0', '#6A1B9A', '#9E9E9E', '#E65100', '#BF360C', '#C62828',
];

// Geo coordinates for festival map markers
const geoLookup: Record<string, { lat: number; lng: number; label: string }> = {
  hanoi: { lat: 21.0285, lng: 105.8542, label: 'Hanoi' },
  'ho-chi-minh-city': { lat: 10.8231, lng: 106.6297, label: 'HCMC' },
  'da-nang': { lat: 16.0544, lng: 108.2022, label: 'Da Nang' },
  'hoi-an': { lat: 15.8801, lng: 108.338, label: 'Hoi An' },
  hue: { lat: 16.4637, lng: 107.5909, label: 'Hue' },
  'nha-trang': { lat: 12.2388, lng: 109.1967, label: 'Nha Trang' },
  dalat: { lat: 11.9404, lng: 108.4583, label: 'Da Lat' },
};

// Build map markers — group festivals by slug (one marker per location)
const festBySlug = new Map<string, typeof festivals>();
festivals.forEach(f => {
  const arr = festBySlug.get(f.slug) || [];
  arr.push(f);
  festBySlug.set(f.slug, arr);
});

const festMapMarkers = Array.from(festBySlug.entries())
  .map(([slug, fests]) => {
    const geo = geoLookup[slug];
    if (!geo) return null;
    return {
      lat: geo.lat,
      lng: geo.lng,
      label: geo.label,
      slug,
      color: monthColors[fests[0].monthIndex],
      url: `/destinations/${slug}/`,
      festivals: fests.map(f => ({
        name: f.name,
        month: f.month,
        destination: f.destination,
      })),
    };
  })
  .filter(Boolean);

// Video lookup for festival cards — prefer preview (smallest), then break-1, then hero
const festCardVideos: Record<string, string> = {};
// Destinations with preview videos
['hanoi','ho-chi-minh-city','da-nang','hoi-an','hue','nha-trang','dalat']
  .forEach(s => festCardVideos[s] = `/videos/destinations/${s}-preview.mp4`);

// Fallback cycle for any slug not in lookup
const fallbackVideos = Object.values(festCardVideos);

// 10 generic festival clips — cycle 3x across 32 events
const festGenericClips = Array.from({ length: 10 }, (_, i) => `/videos/pillar/festival-card-${i + 1}.mp4`);

---
<BaseLayout
  title={pageTitle}
  description={pageDescription}
  pageType="destination"
  breadcrumbs={breadcrumbs}
>
  <!-- Hero -->
  <header class="fest-hero">
    <video class="fest-hero-video" autoplay muted loop playsinline preload="metadata">
      <source src="/videos/pillar/festivals-hero.mp4" type="video/mp4" />
    </video>
    <div class="fest-hero-gradient"></div>
    <div class="fest-hero-noise"></div>

    <div class="fest-hero-content">
      <h1 class="fest-hero-title">Vietnamese Festival Calendar 2026</h1>
      <p class="fest-hero-subtitle">From Tet's fireworks and family feasts to Hoi An's magical lantern nights — time your trip to the celebrations that define each destination.</p>
      <div class="fest-hero-meta">
        <div class="fest-hero-meta-item">
          <span class="fest-hero-meta-label">Festivals</span>
          <span class="fest-hero-meta-value">18</span>
        </div>
        <div class="fest-hero-meta-item">
          <span class="fest-hero-meta-label">Destinations</span>
          <span class="fest-hero-meta-value">7</span>
        </div>
        <div class="fest-hero-meta-item">
          <span class="fest-hero-meta-label">Season</span>
          <span class="fest-hero-meta-value">Year-Round</span>
        </div>
      </div>
    </div>

    <div class="fest-scroll-hint">Scroll<br />&#8595;</div>
  </header>

  <!-- Breadcrumb -->
  <div class="container-content">
    <Breadcrumb items={breadcrumbs} />
  </div>

  <!-- Personal intro -->
  <section class="fest-personal reveal">
    <div class="container-content">
      <blockquote class="fest-personal-quote">
        <p>Vietnam loves a celebration &mdash; and they've built an entire culture around proving it. There are festivals for harvests, ancestors, historical events, and things that don't need a reason at all. From the explosive energy of Tet to the lantern-lit beauty of Mid-Autumn Festival, there's always something happening somewhere. It's part of what makes Vietnam feel so alive, and I try to plan around at least one every trip.</p>
        <cite>&mdash; Scott</cite>
      </blockquote>
    </div>
  </section>

  <!-- View Toggle -->
  <div class="container-content" style="padding-top: var(--space-2); padding-bottom: var(--space-4);">
    <div class="fest-view-toggle">
      <button class="fest-toggle-btn active" id="festBtnCalendar">Calendar</button>
      <button class="fest-toggle-btn" id="festBtnMap">Map</button>
    </div>
  </div>

  <!-- Calendar Grid -->
  <div id="festCalendarView">
  <section class="fest-calendar reveal">
    <div class="container-content">
      <h2 class="fest-section-heading">Festivals by Month</h2>
      <p class="fest-section-sub">Click any festival to explore its destination. Hover for a preview.</p>

      <div class="fest-month-grid">
        {months.map((monthName, i) => {
          const monthFestivals = festivals.filter(f => f.monthIndex === i);
          return (
            <div class="fest-month-card reveal">
              <div class="fest-month-header">
                <span class="fest-month-name">{monthName}</span>
                {monthFestivals.length > 0 && (
                  <span class="fest-month-count">{monthFestivals.length}</span>
                )}
              </div>
              <div class="fest-month-body">
                {monthFestivals.length > 0 ? (
                  monthFestivals.map((fest) => {
                    const idx = festivals.indexOf(fest);
                    const destVideo = festCardVideos[fest.slug] || fallbackVideos[idx % fallbackVideos.length];
                    const festVideo = festGenericClips[idx % festGenericClips.length];
                    return (
                    <a href={`/destinations/${fest.slug}/`} class="fest-entry">
                      <div class="fest-entry-media" style={`background: ${monthGradients[i]};`}>
                        <video class="fest-card-video fest-vid-dest" muted loop playsinline preload="none" data-src={destVideo}></video>
                        <video class="fest-card-video fest-vid-fest" muted loop playsinline preload="none" data-src={festVideo} style="opacity:0;"></video>
                        <div class="fest-card-scrim"></div>
                        <div class="fest-entry-media-label">{fest.month}</div>
                      </div>
                      <div class="fest-entry-info">
                        <div class="fest-entry-name">{fest.name}</div>
                        <div class="fest-entry-destination">{fest.destination}</div>
                      </div>
                      <div class="fest-entry-overlay">
                        <p class="fest-entry-desc">{fest.description}</p>
                        <span class="fest-entry-cta">Explore {fest.destination} &rarr;</span>
                      </div>
                    </a>
                  );})
                ) : (
                  <div class="fest-month-empty">No major festivals</div>
                )}
              </div>
            </div>
          );
        })}
      </div>
    </div>
  </section>

  </div><!-- /festCalendarView -->

  <!-- Map View (hidden by default) -->
  <div id="festMapView" style="display:none;">
    <section style="padding: var(--space-4) 0 var(--space-8);">
      <div class="container-content">
        <div class="fest-map-container" id="festMapContainer">
          <div class="fest-map-tooltip" id="festMapTooltip">
            <div class="fest-map-tooltip-name" id="festTooltipName"></div>
            <div class="fest-map-tooltip-fests" id="festTooltipFests"></div>
          </div>
          <div id="festLeafletMap"></div>
          <div class="fest-map-legend">
            <div class="fest-map-legend-item"><div class="fest-map-legend-dot" style="background:var(--color-warm-coral);"></div>Festival location</div>
            <div class="fest-map-legend-note">Colored by month &middot; Click to explore destination</div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Bottom CTA -->
  <section class="fest-cta-section reveal">
    <div class="container-content">
      <div class="fest-cta-card">
        <h2 class="fest-cta-heading">Plan Your Festival Trip</h2>
        <p class="fest-cta-text">Let our AI travel planner build a custom itinerary around the festivals you want to see — with flights, hotels, and day-by-day schedules.</p>
        <a href="/plan/" class="fest-cta-button">Start Planning &rarr;</a>
      </div>
    </div>
  </section>

  <!-- FAQ -->
  <FAQ items={[
    { question: "What are the biggest festivals in Vietnam?", answer: "Tet Nguyen Dan (Lunar New Year) is by far the biggest — the entire country celebrates for a week in January or February. Mid-Autumn Festival (Tet Trung Thu) fills streets with lanterns and lion dances. Hue Festival is the premier cultural event. Hoi An Lantern Festival is the most photogenic monthly celebration. Each offers a completely different experience." },
    { question: "When is Tet (Lunar New Year) in Vietnam?", answer: "Tet follows the lunar calendar, typically falling in late January or early February. It's a week-long national holiday when most businesses close and families reunite. Book accommodation 2-3 months ahead — prices triple during Tet week. Many restaurants close, but the atmosphere is incredible with flower markets, fireworks, and family celebrations everywhere." },
    { question: "How do I plan a trip around a Vietnamese festival?", answer: "Pick your festival, then book accommodation 2-3 months early (prices can double or triple during major festivals like Tet). Arrive 2-3 days before the main event for the buildup atmosphere. Be aware that during Tet, many businesses close for up to a week. Use our AI Trip Planner at /plan/ to build a festival-centered itinerary with hotel and transport bookings." },
    { question: "Are Vietnamese festivals safe for tourists?", answer: "Vietnamese festivals are very safe and locals are welcoming to foreign visitors. The main risks are pickpockets in dense crowds and sunburn from long outdoor exposure. Keep valuables in a front pocket or neck pouch, stay hydrated, and wear sunscreen. Water-throwing is common during some celebrations — keep your phone in a waterproof pouch." },
    { question: "What should I wear to a festival in Vietnam?", answer: "Lightweight, breathable clothing — it's hot and you'll be in crowds for hours. Comfortable closed-toe shoes for walking. Cover shoulders and knees if visiting temples or pagodas during religious festivals. Bring a small waterproof bag for your phone. Sunglasses, hat, and sunscreen are essential." },
    { question: "What is the Hoi An Lantern Festival?", answer: "On the 14th day of each lunar month, Hoi An turns off its electric lights and the Ancient Town glows with hundreds of colorful silk lanterns and candles. Paper lanterns float down the Thu Bon River while traditional music fills the streets. It happens every month — check a lunar calendar for exact dates. It's the most magical evening experience in all of Vietnam." },
  ]} />

  <!-- Email Capture -->
  <div class="container-content reveal" style="padding-bottom: var(--space-6);">
    <EmailCapture
      leadMagnet="Get Our Free Festival Trip Planner"
      description="A month-by-month PDF guide to Vietnamese festivals — with travel logistics, accommodation tips, and what to expect at each celebration."
      bullets={[
        'All 18 festivals with exact dates and locations',
        'How to get there and where to stay for each event',
        'Insider tips — best viewing spots, what to wear, what to bring',
        'Suggested multi-festival itineraries',
      ]}
      guideTag="pillar-festivals"
    />
  </div>

  <!-- Cross-links -->
  <section class="fest-crosslinks reveal">
    <div class="container-content">
      <h3 class="fest-crosslinks-heading">Explore More</h3>
      <div class="fest-crosslinks-grid">
        <a href="/practical/" class="fest-crosslink-card">
          <span class="fest-crosslink-icon">&#127754;</span>
          <span class="fest-crosslink-label">Snorkeling Guide</span>
          <span class="fest-crosslink-desc">14 destinations ranked by what you'll see in the water</span>
        </a>
        <a href="/destinations/" class="fest-crosslink-card">
          <span class="fest-crosslink-icon">&#127965;</span>
          <span class="fest-crosslink-label">All Destinations</span>
          <span class="fest-crosslink-desc">Every island we've explored with honest reviews</span>
        </a>
      </div>
    </div>
  </section>

</BaseLayout>

<!-- Scroll Reveal Observer -->
<script>
  if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
    const revealObserver = new IntersectionObserver(
      (entries) => {
        entries.forEach((e) => {
          if (e.isIntersecting) {
            e.target.classList.add('visible');
          }
        });
      },
      { threshold: 0.1, rootMargin: '0px 0px -40px 0px' }
    );
    document.querySelectorAll('.reveal').forEach((el) => revealObserver.observe(el));
  } else {
    document.querySelectorAll('.reveal').forEach((el) => el.classList.add('visible'));
  }
</script>

<!-- Festival card video lazy-load + dual-video cycling -->
<script>
  const festMediaEls = document.querySelectorAll('.fest-entry-media');
  const festSwapTimers = new Map<Element, number>();

  function festLoadAndPlay(video: HTMLVideoElement) {
    if (!video.src && video.dataset.src) {
      video.src = video.dataset.src;
    }
    video.play().catch(() => {});
  }

  function festStartCycle(media: Element) {
    const dest = media.querySelector<HTMLVideoElement>('.fest-vid-dest');
    const fest = media.querySelector<HTMLVideoElement>('.fest-vid-fest');
    if (!dest || !fest) return;

    festLoadAndPlay(dest);
    festLoadAndPlay(fest);

    // Start with dest visible, swap every 6 seconds
    let showingDest = true;
    const timer = window.setInterval(() => {
      showingDest = !showingDest;
      dest.style.opacity = showingDest ? '1' : '0';
      fest.style.opacity = showingDest ? '0' : '1';
    }, 6000);
    festSwapTimers.set(media, timer);
  }

  function festStopCycle(media: Element) {
    const timer = festSwapTimers.get(media);
    if (timer) {
      clearInterval(timer);
      festSwapTimers.delete(media);
    }
    media.querySelectorAll<HTMLVideoElement>('.fest-card-video').forEach(v => v.pause());
  }

  const festObserver = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          festStartCycle(entry.target);
        } else {
          festStopCycle(entry.target);
        }
      });
    },
    { threshold: 0.2, rootMargin: '100px' }
  );
  festMediaEls.forEach((el) => festObserver.observe(el));
</script>

<!-- View Toggle Logic -->
<script>
  const festBtnCalendar = document.getElementById('festBtnCalendar');
  const festBtnMap = document.getElementById('festBtnMap');
  const festCalendarView = document.getElementById('festCalendarView');
  const festMapView = document.getElementById('festMapView');

  function festShowCalendar() {
    festCalendarView!.style.display = '';
    festMapView!.style.display = 'none';
    festBtnCalendar!.classList.add('active');
    festBtnMap!.classList.remove('active');
  }

  function festShowMap() {
    festCalendarView!.style.display = 'none';
    festMapView!.style.display = '';
    festBtnCalendar!.classList.remove('active');
    festBtnMap!.classList.add('active');
    if (window.festMap) {
      window.festMap.invalidateSize();
    }
  }

  festBtnCalendar?.addEventListener('click', festShowCalendar);
  festBtnMap?.addEventListener('click', festShowMap);
</script>

<!-- Leaflet Map for Festivals -->
<script is:inline define:vars={{ markers: festMapMarkers }}>
  // Load Leaflet CSS
  if (!document.getElementById('leaflet-css')) {
    var lnk = document.createElement('link');
    lnk.id = 'leaflet-css';
    lnk.rel = 'stylesheet';
    lnk.href = 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css';
    document.head.appendChild(lnk);
  }

  function initFestMap() {
    var mapEl = document.getElementById('festLeafletMap');
    if (!mapEl || typeof L === 'undefined') return;

    var map = L.map(mapEl, {
      center: [12.0, 122.5],
      zoom: 6,
      scrollWheelZoom: false,
      minZoom: 5,
      maxZoom: 12,
      maxBounds: [[4, 115], [22, 130]],
      zoomControl: false,
      attributionControl: false,
    });

    window.festMap = map;

    L.control.attribution({ prefix: false }).addTo(map);
    L.control.zoom({ position: 'topright' }).addTo(map);

    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
      attribution: '\u00a9 <a href="https://www.openstreetmap.org/copyright">OSM</a> \u00a9 <a href="https://carto.com/">CARTO</a>',
      maxZoom: 19,
    }).addTo(map);

    function makeCircle(color, size, stroke) {
      return L.divIcon({
        className: '',
        html: '<div style="width:' + size + 'px;height:' + size + 'px;border-radius:50%;background:' + color + ';border:2px solid ' + stroke + ';box-shadow:0 0 6px rgba(0,0,0,0.3);cursor:pointer;"></div>',
        iconSize: [size, size],
        iconAnchor: [size / 2, size / 2],
      });
    }

    var tooltip = document.getElementById('festMapTooltip');
    var tooltipName = document.getElementById('festTooltipName');
    var tooltipFests = document.getElementById('festTooltipFests');
    var container = document.getElementById('festMapContainer');

    markers.forEach(function(m) {
      var size = m.festivals.length > 1 ? 18 : 14;
      var icon = makeCircle(m.color, size, '#ffffff');
      var marker = L.marker([m.lat, m.lng], { icon: icon, title: m.label }).addTo(map);

      marker.on('mouseover', function(e) {
        if (tooltipName) tooltipName.textContent = m.label;
        if (tooltipFests) {
          tooltipFests.innerHTML = m.festivals.map(function(f) {
            return '<div class="fest-map-tooltip-fest"><span class="fest-map-tooltip-month">' + f.month + '</span> ' + f.name + '</div>';
          }).join('');
        }
        if (tooltip) tooltip.classList.add('fest-tooltip-visible');
        if (container && tooltip) {
          var pt = e.containerPoint;
          tooltip.style.left = (pt.x + 12) + 'px';
          tooltip.style.top = (pt.y - 10) + 'px';
        }
      });

      marker.on('mouseout', function() {
        if (tooltip) tooltip.classList.remove('fest-tooltip-visible');
      });

      marker.on('click', function() {
        window.location.href = m.url;
      });
    });
  }

  // Load Leaflet JS
  if (typeof L !== 'undefined') {
    initFestMap();
  } else {
    var lscript = document.createElement('script');
    lscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js';
    lscript.onload = initFestMap;
    document.head.appendChild(lscript);
  }
</script>

<style>
  /* ================================================================
     HERO — Festival gradient (warm coral → gold → deep night)
     ================================================================ */
  .fest-hero {
    position: relative;
    min-height: 60vh;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    padding: 5rem var(--space-6) 60px;
    overflow: hidden;
  }

  .fest-hero-video {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: 0;
  }

  .fest-hero-gradient {
    position: absolute;
    inset: 0;
    z-index: 1;
    background: linear-gradient(to bottom, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0.15) 40%, rgba(0,0,0,0.55) 100%);
  }

  .fest-hero-noise {
    position: absolute;
    inset: 0;
    z-index: 2;
    background: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
    pointer-events: none;
  }

  .fest-hero-content {
    position: relative;
    z-index: 3;
    max-width: 720px;
  }

  .fest-hero-title {
    font-size: clamp(2rem, 5vw, 3.2rem);
    font-weight: var(--weight-bold);
    color: #fff;
    line-height: 1.1;
    margin: 0 0 var(--space-3);
  }

  .fest-hero-subtitle {
    font-size: clamp(1rem, 2vw, 1.15rem);
    color: rgba(255, 255, 255, 0.85);
    line-height: 1.6;
    margin: 0 0 var(--space-5);
    max-width: 580px;
  }

  .fest-hero-meta {
    display: flex;
    gap: var(--space-5);
    flex-wrap: wrap;
  }

  .fest-hero-meta-item {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .fest-hero-meta-label {
    font-size: 0.65rem;
    font-weight: var(--weight-semibold);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: rgba(255, 255, 255, 0.5);
  }

  .fest-hero-meta-value {
    font-size: 1.1rem;
    font-weight: var(--weight-bold);
    color: #fff;
  }

  .fest-scroll-hint {
    position: absolute;
    bottom: 16px;
    right: var(--space-6);
    z-index: 3;
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    color: rgba(255, 255, 255, 0.35);
    text-align: center;
    animation: festBounce 2s ease-in-out infinite;
  }

  @keyframes festBounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(6px); }
  }

  /* ================================================================
     CALENDAR GRID
     ================================================================ */
  .fest-calendar {
    padding: var(--space-10) 0 var(--space-8);
  }

  .fest-section-heading {
    font-size: clamp(1.5rem, 3vw, 2rem);
    font-weight: var(--weight-bold);
    color: var(--color-deep-night);
    margin: 0 0 var(--space-2);
    text-align: center;
  }

  .fest-section-sub {
    font-size: 1rem;
    color: var(--color-slate);
    text-align: center;
    margin: 0 0 var(--space-8);
  }

  .fest-month-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--space-5);
  }

  @media (max-width: 1024px) {
    .fest-month-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 640px) {
    .fest-month-grid {
      grid-template-columns: 1fr;
    }
  }

  /* ================================================================
     MONTH CARD
     ================================================================ */
  .fest-month-card {
    background: var(--color-white);
    border: 1px solid rgba(0, 0, 0, 0.06);
    border-radius: 16px;
    overflow: hidden;
    transition: box-shadow 0.3s ease;
  }

  .fest-month-card:hover {
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
  }

  .fest-month-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--space-3) var(--space-4);
    background: var(--color-sky);
    border-bottom: 1px solid rgba(0, 0, 0, 0.04);
  }

  .fest-month-name {
    font-size: 0.9rem;
    font-weight: var(--weight-bold);
    color: var(--color-deep-night);
    text-transform: uppercase;
    letter-spacing: 0.06em;
  }

  .fest-month-count {
    font-size: 0.7rem;
    font-weight: var(--weight-semibold);
    color: var(--color-warm-coral);
    background: rgba(232, 101, 74, 0.1);
    padding: 2px 8px;
    border-radius: 12px;
  }

  .fest-month-body {
    padding: var(--space-3);
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
    min-height: 80px;
  }

  .fest-month-empty {
    display: flex;
    align-items: center;
    justify-content: center;
    flex: 1;
    font-size: 0.85rem;
    color: var(--color-slate);
    opacity: 0.5;
    font-style: italic;
  }

  /* ================================================================
     FESTIVAL ENTRY (within month card)
     ================================================================ */
  .fest-entry {
    position: relative;
    display: block;
    border-radius: 12px;
    overflow: hidden;
    text-decoration: none;
    color: inherit;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    border: 1px solid rgba(0, 0, 0, 0.05);
  }

  .fest-entry:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 32px rgba(0, 0, 0, 0.12);
  }

  .fest-entry-media {
    position: relative;
    aspect-ratio: 16 / 9;
    display: flex;
    align-items: flex-end;
    justify-content: flex-end;
    padding: var(--space-2);
    overflow: hidden;
  }

  .fest-card-video {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: 0;
    transition: opacity 0.8s ease;
  }

  .fest-card-scrim {
    position: absolute;
    inset: 0;
    z-index: 1;
    background: linear-gradient(to bottom, rgba(0,0,0,0.05) 0%, rgba(0,0,0,0.1) 40%, rgba(0,0,0,0.45) 100%);
  }

  .fest-entry-media-label {
    position: relative;
    z-index: 2;
    font-size: 0.6rem;
    font-weight: var(--weight-bold);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: rgba(255, 255, 255, 0.7);
    background: rgba(0, 0, 0, 0.25);
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
    padding: 2px 8px;
    border-radius: 6px;
  }

  .fest-entry-info {
    padding: var(--space-2) var(--space-3) var(--space-3);
    background: var(--color-white);
  }

  .fest-entry-name {
    font-size: 0.85rem;
    font-weight: var(--weight-bold);
    color: var(--color-deep-night);
    margin-bottom: 2px;
    line-height: 1.3;
  }

  .fest-entry-destination {
    font-size: 0.72rem;
    color: var(--color-ocean-teal);
    font-weight: var(--weight-medium);
  }

  /* Hover overlay */
  .fest-entry-overlay {
    position: absolute;
    inset: 0;
    background: rgba(26, 35, 50, 0.93);
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding: var(--space-4);
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .fest-entry:hover .fest-entry-overlay {
    opacity: 1;
  }

  .fest-entry-desc {
    font-size: 0.78rem;
    color: rgba(255, 255, 255, 0.9);
    line-height: 1.55;
    margin: 0 0 var(--space-3);
  }

  .fest-entry-cta {
    font-size: 0.72rem;
    font-weight: var(--weight-semibold);
    color: var(--color-warm-coral);
    letter-spacing: 0.02em;
  }

  /* ================================================================
     BOTTOM CTA
     ================================================================ */
  .fest-cta-section {
    padding: var(--space-6) 0 var(--space-8);
  }

  .fest-cta-card {
    background: linear-gradient(135deg, var(--color-deep-night) 0%, #2D3748 100%);
    border-radius: 20px;
    padding: var(--space-8) var(--space-6);
    text-align: center;
    color: #fff;
  }

  .fest-cta-heading {
    font-size: clamp(1.3rem, 3vw, 1.8rem);
    font-weight: var(--weight-bold);
    margin: 0 0 var(--space-3);
    color: #fff;
  }

  .fest-cta-text {
    font-size: 1rem;
    color: rgba(255, 255, 255, 0.75);
    max-width: 520px;
    margin: 0 auto var(--space-5);
    line-height: 1.6;
  }

  .fest-cta-button {
    display: inline-block;
    background: var(--color-warm-coral);
    color: #fff;
    font-size: 0.9rem;
    font-weight: var(--weight-semibold);
    padding: 12px 28px;
    border-radius: 40px;
    text-decoration: none;
    transition: background 0.2s ease, transform 0.2s ease;
  }

  .fest-cta-button:hover {
    background: #d4553b;
    transform: translateY(-2px);
  }

  /* ================================================================
     CROSS-LINKS
     ================================================================ */
  .fest-crosslinks {
    padding: 0 0 var(--space-10);
  }

  .fest-crosslinks-heading {
    font-size: 1.1rem;
    font-weight: var(--weight-bold);
    color: var(--color-deep-night);
    text-align: center;
    margin: 0 0 var(--space-4);
  }

  .fest-crosslinks-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-4);
    max-width: 640px;
    margin: 0 auto;
  }

  @media (max-width: 640px) {
    .fest-crosslinks-grid {
      grid-template-columns: 1fr;
    }
  }

  .fest-crosslink-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-5) var(--space-4);
    background: var(--color-white);
    border: 1px solid rgba(0, 0, 0, 0.06);
    border-radius: 16px;
    text-decoration: none;
    color: inherit;
    text-align: center;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .fest-crosslink-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
  }

  .fest-crosslink-icon {
    font-size: 1.8rem;
  }

  .fest-crosslink-label {
    font-size: 0.95rem;
    font-weight: var(--weight-bold);
    color: var(--color-deep-night);
  }

  .fest-crosslink-desc {
    font-size: 0.78rem;
    color: var(--color-slate);
    line-height: 1.4;
  }

  /* ================================================================
     RESPONSIVE — Hero adjustments
     ================================================================ */
  @media (max-width: 640px) {
    .fest-hero {
      min-height: 55vh;
      padding: 0 var(--space-4) 40px;
    }

    .fest-hero-meta {
      gap: var(--space-4);
    }

    .fest-scroll-hint {
      display: none;
    }
  }

  /* ================================================================
     VIEW TOGGLE
     ================================================================ */
  .fest-view-toggle {
    display: flex;
    justify-content: center;
    gap: 4px;
    background: var(--color-sand-dark);
    border-radius: 40px;
    padding: 4px;
    max-width: 240px;
    margin: 0 auto;
  }

  .fest-toggle-btn {
    flex: 1;
    padding: 8px 20px;
    border: none;
    border-radius: 36px;
    font-size: 0.82rem;
    font-weight: var(--weight-semibold);
    cursor: pointer;
    background: transparent;
    color: var(--color-slate);
    transition: background 0.2s ease, color 0.2s ease;
  }

  .fest-toggle-btn.active {
    background: var(--color-ocean-teal);
    color: #fff;
  }

  .fest-toggle-btn:hover:not(.active) {
    color: var(--color-deep-night);
  }

  /* ================================================================
     MAP VIEW
     ================================================================ */
  .fest-map-container {
    border-radius: 24px;
    position: relative;
    overflow: hidden;
    background: radial-gradient(ellipse at 40% 30%, #0c3547 0%, #091e2f 40%, #060f1a 100%);
    padding: 28px 20px 20px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.35), inset 0 1px 0 rgba(255, 255, 255, 0.05);
    max-width: 600px;
    margin: 0 auto;
  }

  .fest-map-container::before {
    content: '';
    position: absolute;
    inset: 0;
    background:
      radial-gradient(ellipse 600px 300px at 30% 70%, rgba(13, 115, 119, 0.08) 0%, transparent 70%),
      radial-gradient(ellipse 400px 200px at 70% 20%, rgba(13, 115, 119, 0.06) 0%, transparent 70%);
    animation: festOceanShimmer 8s ease-in-out infinite alternate;
    pointer-events: none;
  }

  .fest-map-container::after {
    content: '';
    position: absolute;
    inset: 0;
    background-image:
      radial-gradient(circle 1px at 20% 30%, rgba(255, 255, 255, 0.03) 0%, transparent 100%),
      radial-gradient(circle 1px at 60% 50%, rgba(255, 255, 255, 0.02) 0%, transparent 100%),
      radial-gradient(circle 1px at 40% 80%, rgba(255, 255, 255, 0.02) 0%, transparent 100%);
    pointer-events: none;
  }

  @keyframes festOceanShimmer {
    0% { opacity: 0.5; }
    100% { opacity: 1; }
  }

  #festLeafletMap {
    width: 100%;
    height: 600px;
    border-radius: 16px;
    position: relative;
    z-index: 1;
  }

  .fest-map-tooltip {
    position: absolute;
    background: rgba(26, 35, 50, 0.95);
    backdrop-filter: blur(12px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    padding: 10px 14px;
    pointer-events: none;
    opacity: 0;
    transform: translateY(4px);
    transition: opacity 0.2s ease, transform 0.2s ease;
    z-index: 50;
    min-width: 180px;
    max-width: 300px;
  }

  .fest-map-tooltip.fest-tooltip-visible {
    opacity: 1;
    transform: translateY(0);
  }

  .fest-map-tooltip-name {
    font-size: 0.85rem;
    font-weight: var(--weight-bold);
    color: white;
    margin-bottom: 4px;
  }

  :global(.fest-map-tooltip-fest) {
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.85);
    line-height: 1.5;
  }

  :global(.fest-map-tooltip-month) {
    font-size: 0.6rem;
    font-weight: var(--weight-bold);
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--color-warm-coral);
    margin-right: 4px;
  }

  .fest-map-legend {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: var(--space-4);
    padding: var(--space-3) var(--space-4);
    flex-wrap: wrap;
    position: relative;
    z-index: 1;
  }

  .fest-map-legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.7rem;
    color: rgba(255, 255, 255, 0.45);
  }

  .fest-map-legend-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    box-shadow: 0 0 6px rgba(13, 115, 119, 0.5);
  }

  .fest-map-legend-note {
    font-size: 0.68rem;
    color: rgba(255, 255, 255, 0.35);
  }

  @media (max-width: 640px) {
    #festLeafletMap { height: 450px; }
  }

  /* Personal intro */
  .fest-personal {
    padding-block: var(--space-8);
  }

  .fest-personal-quote {
    max-width: 680px;
    margin: 0 auto;
    padding: var(--space-6) var(--space-8);
    border-left: 4px solid #D97706;
    background: var(--color-sky);
    border-radius: 0 12px 12px 0;
  }

  .fest-personal-quote p {
    font-size: var(--text-body);
    color: var(--color-heading);
    line-height: var(--leading-body);
    font-style: italic;
    margin-bottom: var(--space-3);
  }

  .fest-personal-quote cite {
    font-size: var(--text-caption);
    color: #D97706;
    font-weight: var(--weight-semibold);
    font-style: normal;
  }
</style>
